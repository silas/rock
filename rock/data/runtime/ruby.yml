env:
  PATH: "${ROCK_PATH}/bin:${ROCK_PATH}/vendor/bundle/ruby/${RUBY_ABI}/bin:${PATH}"
  RUBYLIB: "${ROCK_PATH}/lib:${RUBYLIB}"
  ROCK_BUNDLE_INSTALL: "install --path=./vendor/bundle"
  ROCK_BUNDLE_INSTALL_DEPLOYMENT: "install --verbose --no-color --deployment"

build: |

  if [[ -z "${ROCK_ARGS_DEPLOYMENT}" ]]; then
    if [[ -f ./Gemfile || -f ./Gemfile.lock ]]; then
      bundle ${ROCK_BUNDLE_INSTALL}
    else
      warn 'no "Gemfile" or "Gemfile.lock" file found'
    fi
  else
    if [[ ! -f ./Gemfile.lock ]]; then
      die 'no "Gemfile.lock" file found'
    fi
    bundle ${ROCK_BUNDLE_INSTALL_DEPLOYMENT}
  fi

test: |

  rake

clean: |

  if [[ -d ./vendor/bundle ]]; then
    rm -fr ./vendor/bundle
  fi

  if [[ -d ./.bundle ]]; then
    rm -fr ./.bundle
  fi
